<!DOCTYPE html>
<html>
<head>
    <title>Submit Feedback</title>

    <style>
        body {
            font-family: Segoe UI;
            background:#f4f6f9;
            margin:0;
        }

        header {
            background:#2e7d32;
            color:white;
            padding:18px 25px;
            font-size:22px;
            font-weight:bold;
        }

        .actions {
            max-width:750px;
            margin:15px auto 0;
        }

        .actions button {
            padding:8px 18px;
            background:#9e9e9e;
            color:white;
            border:none;
            border-radius:5px;
            cursor:pointer;
        }

        .actions button:hover {
            background:#7d7d7d;
        }

        .box {
            background:white;
            max-width:750px;
            margin:15px auto 40px;
            padding:30px;
            border-radius:10px;
        }

        /* âœ… LABELS BOLD */
        label {
            font-weight: bold;
        }

        select, textarea {
            width:100%;
            padding:10px;
            margin-top:8px;
            margin-bottom:15px;
        }

        button.submit {
            padding:12px 25px;
            background:#2e7d32;
            color:white;
            border:none;
            border-radius:5px;
            cursor:pointer;
        }

        button.submit:hover {
            background:#256628;
        }
    </style>
</head>

<body>

<header>
    Submit Feedback
</header>

<div class="actions">
    <button onclick="goBack()">Back</button>
</div>

<div class="box">

    <label>Group</label>
    <select id="group">
        <option>Loading groups...</option>
    </select>

    <label>Subject</label>
    <select id="subject">
        <option>Math</option>
        <option>Science</option>
        <option>English</option>
        <option>Arabic</option>
        <option>ICT</option>
        <option>Physics</option>
        <option>Chemistry</option>
        <option>Biology</option>
        <option>History</option>
        <option>Geography</option>
    </select>

    <label>Understanding Level</label>
    <select id="level">
        <option>High - I got it!</option>
        <option>Medium - Needs practice</option>
        <option>Low - I'm confused</option>
    </select>

    <label>Problems Faced</label>
    <textarea id="problems"></textarea>

    <label>Notes</label>
    <textarea id="notes"></textarea>

    <button class="submit" onclick="submitFeedback()">Submit</button>

</div>

<script>
const API = "http://127.0.0.1:8000";

function goBack() {
    window.location.href = "dashboard.html";
}

async function loadGroups() {
    const select = document.getElementById("group");
    select.innerHTML = "<option>Loading groups...</option>";

    try {
        const res = await fetch(API + "/groups/active");
        const groups = await res.json();

        select.innerHTML = "";

        if (groups.length === 0) {
            select.innerHTML = "<option>No active groups</option>";
            return;
        }

        groups.forEach(g => {
            const opt = document.createElement("option");
            opt.value = g.group_name;
            opt.textContent = g.group_name;
            select.appendChild(opt);
        });

    } catch {
        select.innerHTML = "<option>Cannot load groups</option>";
    }
}

async function submitFeedback() {
    await fetch(API + "/feedback", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            username: localStorage.getItem("username"),
            group: document.getElementById("group").value,
            subject: document.getElementById("subject").value,
            level: document.getElementById("level").value,
            problems: document.getElementById("problems").value,
            notes: document.getElementById("notes").value
        })
    });

    alert("Feedback submitted successfully");
    window.location.href = "dashboard.html";
}

loadGroups();
</script>

</body>
</html>
