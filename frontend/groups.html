<!DOCTYPE html>
<html>
<head>
    <title>Group Management</title>

    <style>
        body {
            font-family: Segoe UI;
            background:#f4f6f9;
            margin:0;
        }

        header {
            background:#2e7d32;
            color:white;
            padding:18px 25px;
            font-size:22px;
            font-weight:bold;
        }

        .actions {
            max-width:820px;
            margin:15px auto 0;
        }

        .actions button {
            padding:8px 18px;
            background:#9e9e9e;
            color:white;
            border:none;
            border-radius:5px;
            cursor:pointer;
        }

        .box {
            background:white;
            max-width:820px;
            margin:15px auto 40px;
            padding:30px;
            border-radius:10px;
        }

        input {
            width:100%;
            padding:10px;
            margin-top:6px;
        }

        button.action {
            padding:8px 14px;
            margin:3px;
            border:none;
            border-radius:5px;
            cursor:pointer;
            color:white;
        }

        .create { background:#2e7d32; }
        .toggle { background:#1565c0; }
        .delete { background:#b71c1c; }

        table {
            width:100%;
            border-collapse:collapse;
            margin-top:20px;
        }

        th, td {
            border:1px solid #ccc;
            padding:8px;
        }

        th {
            background:#2e7d32;
            color:white;
        }
    </style>
</head>

<body>

<header>Group Management</header>

<div class="actions">
    <button onclick="goBack()">Back</button>
</div>

<div class="box">

    <input id="groupName" placeholder="Group name">
    <button class="action create" onclick="createGroup()">Create Group</button>

    <table>
        <thead>
            <tr>
                <th>Group</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="groups"></tbody>
    </table>

</div>

<script>
const API = "http://127.0.0.1:8000";

function goBack() {
    window.location.href = "dashboard.html";
}

async function loadGroups() {
    const res = await fetch(API + "/groups");
    const data = await res.json();
    const t = document.getElementById("groups");
    t.innerHTML = "";

    data.forEach(g => {
        t.innerHTML += `
        <tr>
            <td>${g.group_name}</td>
            <td>${g.is_active ? "ACTIVE" : "DISABLED"}</td>
            <td>
                <button class="action toggle" onclick="toggleGroup('${g.group_name}')">
                    ${g.is_active ? "Disable" : "Enable"}
                </button>
                <button class="action delete" onclick="deleteGroup('${g.group_name}')">
                    Delete
                </button>
            </td>
        </tr>`;
    });
}

async function createGroup() {
    const name = groupName.value.trim();
    if (!name) return alert("Group name is required");

    await fetch(API + "/groups/create", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ group: name })
    });

    groupName.value = "";
    loadGroups();
}

async function toggleGroup(group) {
    await fetch(API + "/groups/toggle", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ group })
    });
    loadGroups();
}

async function deleteGroup(group) {
    if (!confirm(`Delete group "${group}"?`)) return;

    await fetch(API + "/groups/delete", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ group })
    });
    loadGroups();
}

loadGroups();
</script>

</body>
</html>
